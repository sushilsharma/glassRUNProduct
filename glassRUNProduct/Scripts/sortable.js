angular.module("ui.sortable",[]).value("uiSortableConfig",{items:"> [ng-repeat],> [data-ng-repeat],> [x-ng-repeat]"}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(c,b,a){return{require:"?ngModel",scope:{ngModel:"=",uiSortable:"=",create:"&uiSortableCreate",start:"&uiSortableStart",activate:"&uiSortableActivate",beforeStop:"&uiSortableBeforeStop",update:"&uiSortableUpdate",remove:"&uiSortableRemove",receive:"&uiSortableReceive",deactivate:"&uiSortableDeactivate",stop:"&uiSortableStop"},link:function(A,j,e,v){var z;var r;function g(E,G){var F=typeof E==="function";var H=typeof G==="function";if(F&&H){return function(){E.apply(this,arguments);G.apply(this,arguments)}}else{if(H){return G}}return E}function o(F){var E=F.data("ui-sortable");if(E&&typeof E==="object"&&E.widgetFullName==="ui-sortable"){return E}return null}function B(E){E.children().each(function(){var F=angular.element(this);F.width(F.width())})}function i(E,F){return F}function x(E,F){if(f[E]){if(E==="stop"){F=g(F,function(){A.$apply()});F=g(F,d)}F=g(f[E],F)}else{if(D[E]){F=D[E](F)}}if(!F&&(E==="items"||E==="ui-model-items")){F=c.items}return F}function y(G,H,J){function E(L,K){if(!(K in w)){w[K]=null}}angular.forEach(f,E);var I=null;if(H){var F;angular.forEach(H,function(M,L){if(!G||!(L in G)){if(L in h){if(L==="ui-floating"){w[L]="auto"}else{w[L]=x(L,undefined)}return}if(!F){F=angular.element.ui.sortable().options}var K=F[L];K=x(L,K);if(!I){I={}}I[L]=K;w[L]=K}})}G=angular.extend({},G);angular.forEach(G,function(M,K){if(K in h){if(K==="ui-floating"&&(M===false||M===true)&&J){J.floating=M}if(K==="ui-preserve-size"&&(M===false||M===true)){var L=w.helper;G.helper=function(N,O){if(w["ui-preserve-size"]===true){B(O)}return(L||i).apply(this,arguments)}}w[K]=x(K,M)}});angular.forEach(G,function(L,K){if(K in h){return}L=x(K,L);if(!I){I={}}I[K]=L;w[K]=L});return I}function m(E){var F=E.sortable("option","placeholder");if(F&&F.element&&typeof F.element==="function"){var G=F.element();G=angular.element(G);return G}return null}function n(E,H){var G=w["ui-model-items"].replace(/[^,]*>/g,"");var F=E.find('[class="'+H.attr("class")+'"]:not('+G+")");return F}function q(E,G){var F=E.sortable("option","helper");return(F==="clone"||(typeof F==="function"&&G.item.sortable.isCustomHelperUsed()))}function p(E,G){var F=null;if(q(E,G)&&E.sortable("option","appendTo")==="parent"){F=r}return F}function u(E){return(/left|right/.test(E.css("float"))||/inline|table-cell/.test(E.css("display")))}function k(G,F){for(var H=0;H<G.length;H++){var E=G[H];if(E.element[0]===F[0]){return E}}}function d(E,F){F.item.sortable._destroy()}function l(E){return E.parent().find(w["ui-model-items"]).index(E)}var w={};var h={"ui-floating":undefined,"ui-model-items":c.items,"ui-preserve-size":undefined};var f={create:null,start:null,activate:null,beforeStop:null,update:null,remove:null,receive:null,deactivate:null,stop:null};var D={helper:null};angular.extend(w,h,c,A.uiSortable);if(!angular.element.fn||!angular.element.fn.jquery){a.error("ui.sortable: jQuery should be included before AngularJS!");return}function C(){A.$watchCollection("ngModel",function(){b(function(){if(!!o(j)){j.sortable("refresh")}},0,false)});f.start=function(E,I){if(w["ui-floating"]==="auto"){var G=I.item.siblings();var H=o(angular.element(E.target));H.floating=u(G)}var F=l(I.item);I.item.sortable={model:v.$modelValue[F],index:F,source:j,sourceList:I.item.parent(),sourceModel:v.$modelValue,cancel:function(){I.item.sortable._isCanceled=true},isCanceled:function(){return I.item.sortable._isCanceled},isCustomHelperUsed:function(){return !!I.item.sortable._isCustomHelperUsed},_isCanceled:false,_isCustomHelperUsed:I.item.sortable._isCustomHelperUsed,_destroy:function(){angular.forEach(I.item.sortable,function(K,J){I.item.sortable[J]=undefined})},_connectedSortables:[],_getElementContext:function(J){return k(this._connectedSortables,J)}}};f.activate=function(E,K){var H=K.item.sortable.source===j;var J=H?K.item.sortable.sourceList:j;var F={element:j,scope:A,isSourceContext:H,savedNodesOrigin:J};K.item.sortable._connectedSortables.push(F);z=J.contents();r=K.helper;var I=m(j);if(I&&I.length){var G=n(j,I);z=z.not(G)}};f.update=function(G,J){if(!J.item.sortable.received){J.item.sortable.dropindex=l(J.item);var E=J.item.parent().closest("[ui-sortable], [data-ui-sortable], [x-ui-sortable]");J.item.sortable.droptarget=E;J.item.sortable.droptargetList=J.item.parent();var F=J.item.sortable._getElementContext(E);J.item.sortable.droptargetModel=F.scope.ngModel;j.sortable("cancel")}var I=!J.item.sortable.received&&p(j,J,z);if(I&&I.length){z=z.not(I)}var H=J.item.sortable._getElementContext(j);z.appendTo(H.savedNodesOrigin);if(J.item.sortable.received){z=null}if(J.item.sortable.received&&!J.item.sortable.isCanceled()){A.$apply(function(){v.$modelValue.splice(J.item.sortable.dropindex,0,J.item.sortable.moved)});A.$emit("ui-sortable:moved",J)}};f.stop=function(E,H){var I="dropindex" in H.item.sortable&&!H.item.sortable.isCanceled();if(I&&!H.item.sortable.received){A.$apply(function(){v.$modelValue.splice(H.item.sortable.dropindex,0,v.$modelValue.splice(H.item.sortable.index,1)[0])});A.$emit("ui-sortable:moved",H)}else{if(!I&&!angular.equals(j.contents().toArray(),z.toArray())){var G=p(j,H,z);if(G&&G.length){z=z.not(G)}var F=H.item.sortable._getElementContext(j);z.appendTo(F.savedNodesOrigin)}}z=null;r=null};f.receive=function(E,F){F.item.sortable.received=true};f.remove=function(E,F){if(!("dropindex" in F.item.sortable)){j.sortable("cancel");F.item.sortable.cancel()}if(!F.item.sortable.isCanceled()){A.$apply(function(){F.item.sortable.moved=v.$modelValue.splice(F.item.sortable.index,1)[0]})}};angular.forEach(f,function(F,E){f[E]=g(f[E],function(){var G=A[E];var H;if(typeof G==="function"&&("uiSortable"+E.substring(0,1).toUpperCase()+E.substring(1)).length&&typeof(H=G())==="function"){H.apply(this,arguments)}})});D.helper=function(E){if(E&&typeof E==="function"){return function(F,I){var J=I.sortable;var G=l(I);I.sortable={model:v.$modelValue[G],index:G,source:j,sourceList:I.parent(),sourceModel:v.$modelValue,_restore:function(){angular.forEach(I.sortable,function(L,K){I.sortable[K]=undefined});I.sortable=J}};var H=E.apply(this,arguments);I.sortable._restore();I.sortable._isCustomHelperUsed=I!==H;return H}}return E};A.$watchCollection("uiSortable",function(E,F){var H=o(j);if(!!H){var G=y(E,F,H);if(G){j.sortable("option",G)}}},true);y(w)}function s(){if(v){C()}else{a.info("ui.sortable: ngModel not provided!",j)}j.sortable(w)}function t(){if(A.uiSortable&&A.uiSortable.disabled){return false}s();t.cancelWatcher();t.cancelWatcher=angular.noop;return true}t.cancelWatcher=angular.noop;if(!t()){t.cancelWatcher=A.$watch("uiSortable.disabled",t)}}}}]);
var directiveModule=angular.module("angularjs-dropdown-multiselect",[]);directiveModule.directive("ngDropdownMultiselect",["$filter","$document","$compile","$parse",function(c,b,a,d){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@"},template:function(g,e){var f=e.checkboxes?true:false;var h=e.groupBy?true:false;var i='<div class="multiselect-parent btn-group dropdown-multiselect">';i+='<button type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}&nbsp;<span class="caret"></span></button>';i+="<ul class=\"dropdown-menu dropdown-menu-form\" ng-style=\"{display: open ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto' }\" style=\"overflow: scroll\" >";i+='<li class="searchfieldinmuliselect" ng-show="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control" style="width: 100%;" ng-model="searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>';i+='<li ng-show="settings.enableSearch" class="divider"></li>';i+='<li class="checkallbtn" ng-hide="!settings.showCheckAll || settings.selectionLimit > 0"><a data-ng-click="selectAll()"><span class="glyphicon glyphicon-ok"></span>  {{texts.checkAll}}</a>';i+='<li class="uncheckallbtn" ng-show="settings.showUncheckAll"><a data-ng-click="deselectAll();"><span class="glyphicon glyphicon-remove"></span>   {{texts.uncheckAll}}</a></li>';i+='<li ng-hide="(!settings.showCheckAll || settings.selectionLimit > 0) && !settings.showUncheckAll" class="divider"></li>';if(h){i+='<li ng-repeat-start="option in orderedItems | filter: searchFilter" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupTitle(getPropertyForObject(option, settings.groupBy)) }}</li>';i+='<li class="multiselectValuedropdownlist" ng-repeat-end role="presentation">'}else{i+='<li class="multiselectValuedropdownlist" role="presentation" ng-repeat="option in options | filter: searchFilter">'}i+='<a role="menuitem" tabindex="-1" ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))">';if(f){i+='<div class="checkbox"><label><input class="checkboxInput" type="checkbox" ng-click="checkboxClick($event, getPropertyForObject(option,settings.idProp))" ng-checked="isChecked(getPropertyForObject(option,settings.idProp))" /> {{getPropertyForObject(option, settings.displayProp)}}</label></div></a>'}else{i+="<span data-ng-class=\"{'glyphicon glyphicon-ok': isChecked(getPropertyForObject(option,settings.idProp))}\"></span> {{getPropertyForObject(option, settings.displayProp)}}</a>"}i+="</li>";i+='<li class="divider" ng-show="settings.selectionLimit > 1"></li>';i+='<li class="multiselectValuedropdownlist" role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>';i+="</ul>";i+="</div>";g.html(i)},link:function(h,g,e){var f=g.children()[0];h.toggleDropdown=function(){h.open=!h.open};h.checkboxClick=function(k,l){h.setSelectedItem(l);k.stopImmediatePropagation()};h.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop};h.settings={dynamicTitle:true,scrollable:false,scrollableHeight:"300px",closeOnBlur:true,displayProp:"Name",idProp:"Id",externalIdProp:"Id",enableSearch:false,selectionLimit:0,showCheckAll:true,showUncheckAll:true,closeOnSelect:false,buttonClasses:"btn btn-default",closeOnDeselect:false,groupBy:e.groupBy||undefined,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop};h.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked"};h.searchFilter=h.searchFilter||"";if(angular.isDefined(h.settings.groupBy)){h.$watch("options",function(k){if(angular.isDefined(k)){h.orderedItems=c("orderBy")(k,h.settings.groupBy)}})}angular.extend(h.settings,h.extraSettings||[]);angular.extend(h.externalEvents,h.events||[]);angular.extend(h.texts,h.translationTexts);h.singleSelection=h.settings.selectionLimit===1;function j(l){var k={};if(h.settings.externalIdProp===""){k[h.settings.idProp]=l}else{k[h.settings.externalIdProp]=l}return k}function i(k){for(var l in k){delete k[l]}}if(h.singleSelection){if(angular.isArray(h.selectedModel)&&h.selectedModel.length===0){i(h.selectedModel)}}if(h.settings.closeOnBlur){b.on("click",function(k){var m=k.target.parentElement;var l=false;while(angular.isDefined(m)&&m!==null&&!l){if(_.contains(m.className.split(" "),"multiselect-parent")&&!l){if(m===f){l=true}}m=m.parentElement}if(!l){h.$apply(function(){h.open=false})}})}h.getGroupTitle=function(k){if(h.settings.groupByTextProvider!==null){return h.settings.groupByTextProvider(k)}return k};h.getButtonText=function(){if(h.settings.dynamicTitle&&(h.selectedModel.length>0||(angular.isObject(h.selectedModel)&&_.keys(h.selectedModel).length>0))){if(h.settings.smartButtonMaxItems>0){var k=[];angular.forEach(h.options,function(o){if(h.isChecked(h.getPropertyForObject(o,h.settings.idProp))){var n=h.getPropertyForObject(o,h.settings.displayProp);var m=h.settings.smartButtonTextConverter(n,o);k.push(m?m:n)}});if(h.selectedModel.length>h.settings.smartButtonMaxItems){k=k.slice(0,h.settings.smartButtonMaxItems);k.push("...")}return k.join(", ")}else{var l;if(h.singleSelection){l=(h.selectedModel!==null&&angular.isDefined(h.selectedModel[h.settings.idProp]))?1:0}else{l=angular.isDefined(h.selectedModel)?h.selectedModel.length:0}if(l===0){return h.texts.buttonDefaultText}else{return l+" "+h.texts.dynamicButtonTextSuffix}}}else{return h.texts.buttonDefaultText}};h.getPropertyForObject=function(k,l){if(angular.isDefined(k)&&k.hasOwnProperty(l)){return k[l]}return""};h.selectAll=function(){h.deselectAll(false);h.externalEvents.onSelectAll();angular.forEach(h.options,function(k){h.setSelectedItem(k[h.settings.idProp],true)})};h.deselectAll=function(k){k=k||true;if(k){h.externalEvents.onDeselectAll()}if(h.singleSelection){i(h.selectedModel)}else{h.selectedModel.splice(0,h.selectedModel.length)}};h.setSelectedItem=function(o,k){var n=j(o);var m=null;if(h.settings.externalIdProp===""){m=_.find(h.options,n)}else{m=n}if(h.singleSelection){i(h.selectedModel);angular.extend(h.selectedModel,m);h.externalEvents.onItemSelect(m);if(h.settings.closeOnSelect){h.open=false}return}k=k||false;var l=_.findIndex(h.selectedModel,n)!==-1;if(!k&&l){h.selectedModel.splice(_.findIndex(h.selectedModel,n),1);h.externalEvents.onItemDeselect(n)}else{if(!l&&(h.settings.selectionLimit===0||h.selectedModel.length<h.settings.selectionLimit)){h.selectedModel.push(m);h.externalEvents.onItemSelect(m)}}if(h.settings.closeOnSelect){h.open=false}};h.isChecked=function(k){if(h.singleSelection){return h.selectedModel!==null&&angular.isDefined(h.selectedModel[h.settings.idProp])&&h.selectedModel[h.settings.idProp]===j(k)[h.settings.idProp]}return _.findIndex(h.selectedModel,j(k))!==-1};h.externalEvents.onInitDone()}}}]);
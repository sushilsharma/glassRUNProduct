!function(c,d){d["true"]=c,function(a,e){"function"==typeof define&&define.amd?define(a):"undefined"!=typeof module&&"object"==typeof c?module.exports=a():e.rangy=a()}(function(){function O(e,f){var g=typeof e[f];return g==ax||!(g!=aw||!e[f])||"unknown"==g}function Q(e,f){return !(typeof e[f]!=aw||!e[f])}function S(e,f){return typeof e[f]!=ay}function U(b){return function(a,e){for(var f=e.length;f--;){if(!b(a,e[f])){return !1}}return !0}}function W(b){return b&&P(b,aC)&&T(b,aB)}function Y(b){return Q(b,"body")?b.body:b.getElementsByTagName("body")[0]}function aa(a){typeof console!=ay&&O(console,"log")&&console.log(a)}function ac(e,f){Z&&f?alert(e):aa(e)}function ae(b){ad.initialized=!0,ad.supported=!1,ac("Rangy is not supported in this environment. Reason: "+b,ad.config.alertOnFail)}function ag(b){ac("Rangy warning: "+b,ad.config.alertOnWarn)}function ai(b){return b.message||b.description||String(b)}function ak(){if(Z&&!ad.initialized){var a,e=!1,f=!1;O(document,"createRange")&&(a=document.createRange(),P(a,aA)&&T(a,az)&&(e=!0));var g=Y(document);if(!g||"body"!=g.nodeName.toLowerCase()){return void ae("No body element found")}if(g&&O(g,"createTextRange")&&(a=g.createTextRange(),W(a)&&(f=!0)),!e&&!f){return void ae("Neither Range nor TextRange are available")}ad.initialized=!0,ad.features={implementsDomRange:e,implementsTextRange:f};var i,k;for(var p in X){(i=X[p]) instanceof ar&&i.init(i,ad)}for(var r=0,s=aj.length;s>r;++r){try{aj[r](ad)}catch(t){k="Rangy init listener threw an exception. Continuing. Detail: "+ai(t),aa(k)}}}}function am(e,f,g){g&&(e+=" in module "+g.name),ad.warn("DEPRECATED: "+e+" is deprecated. Please use "+f+" instead.")}function ao(e,f,g,h){e[f]=function(){return am(f,g,h),e[g].apply(e,ab.toArray(arguments))}}function aq(e){e=e||window,ak();for(var f=0,g=al.length;g>f;++f){al[f](e)}}function ar(e,f,g){this.name=e,this.dependencies=f,this.initialized=!1,this.supported=!1,this.initializer=g}function at(e,f,g){var h=new ar(e,f,function(a){if(!a.initialized){a.initialized=!0;try{g(ad,a),a.supported=!0}catch(i){var j="Module '"+e+"' failed to load: "+ai(i);aa(j),i.stack&&aa(i.stack)}}});return X[e]=h,h}function au(){}function av(){}var aw="object",ax="function",ay="undefined",az=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],aA=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],aB=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],aC=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],P=U(O),R=U(Q),T=U(S),V=[].forEach?function(e,f){e.forEach(f)}:function(e,f){for(var g=0,h=e.length;h>g;++g){f(e[g],g)}},X={},Z=typeof window!=ay&&typeof document!=ay,ab={isHostMethod:O,isHostObject:Q,isHostProperty:S,areHostMethods:P,areHostObjects:R,areHostProperties:T,isTextRange:W,getBody:Y,forEach:V},ad={version:"1.3.0",initialized:!1,isBrowser:Z,supported:!0,util:ab,features:{},modules:X,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==ay?!0:rangyAutoInitialize}};ad.fail=ae,ad.warn=ag;var af;({}).hasOwnProperty?(ab.extend=af=function(g,h,i){var j,k;for(var l in h){h.hasOwnProperty(l)&&(j=g[l],k=h[l],i&&null!==j&&"object"==typeof j&&null!==k&&"object"==typeof k&&af(j,k,!0),g[l]=k)}return h.hasOwnProperty("toString")&&(g.toString=h.toString),g},ab.createOptions=function(e,f){var g={};return af(g,f),e&&af(g,e),g}):ae("hasOwnProperty not supported"),Z||ae("Rangy can only run in a browser"),function(){var e;if(Z){var f=document.createElement("div");f.appendChild(document.createElement("span"));var g=[].slice;try{1==g.call(f.childNodes,0)[0].nodeType&&(e=function(b){return g.call(b,0)})}catch(h){}}e||(e=function(i){for(var j=[],k=0,l=i.length;l>k;++k){j[k]=i[k]}return j}),ab.toArray=e}();var ah;Z&&(O(document,"addEventListener")?ah=function(e,f,g){e.addEventListener(f,g,!1)}:O(document,"attachEvent")?ah=function(e,f,g){e.attachEvent("on"+f,g)}:ae("Document does not have required addEventListener or attachEvent method"),ab.addListener=ah);var aj=[];ab.deprecationNotice=am,ab.createAliasForDeprecatedMethod=ao,ad.init=ak,ad.addInitListener=function(b){ad.initialized?b(ad):aj.push(b)};var al=[];ad.addShimListener=function(b){al.push(b)},Z&&(ad.shim=ad.createMissingNativeApi=aq,ao(ad,"createMissingNativeApi","shim")),ar.prototype={init:function(){for(var f,g,h=this.dependencies||[],i=0,j=h.length;j>i;++i){if(g=h[i],f=X[g],!(f&&f instanceof ar)){throw new Error("required module '"+g+"' not found")}if(f.init(),!f.supported){throw new Error("required module '"+g+"' not supported")}}this.initializer(this)},fail:function(b){throw this.initialized=!0,this.supported=!1,new Error(b)},warn:function(b){ad.warn("Module "+this.name+": "+b)},deprecationNotice:function(e,f){ad.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+f+" instead")},createError:function(b){return new Error("Error in Rangy "+this.name+" module: "+b)}},ad.createModule=function(e){var f,g;2==arguments.length?(f=arguments[1],g=[]):(f=arguments[2],g=arguments[1]);var h=at(e,g,f);ad.initialized&&ad.supported&&h.init()},ad.createCoreModule=function(e,f,g){at(e,f,g)},ad.RangePrototype=au,ad.rangePrototype=new au,ad.selectionPrototype=new av,ad.createCoreModule("DomUtil",[],function(N,aE){function aG(e){var f;return typeof e.namespaceURI==aN||null===(f=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==f}function aI(e){var f=e.parentNode;return 1==f.nodeType?f:null}function aK(e){for(var f=0;e=e.previousSibling;){++f}return f}function aM(b){switch(b.nodeType){case 7:case 10:return 0;case 3:case 8:return b.length;default:return b.childNodes.length}}function aO(e,f){var g,h=[];for(g=e;g;g=g.parentNode){h.push(g)}for(g=f;g;g=g.parentNode){if(aX(h,g)){return g}}return null}function aQ(e,f,g){for(var h=g?f:f.parentNode;h;){if(h===e){return !0}h=h.parentNode}return !1}function aS(e,f){return aQ(e,f,!0)}function aU(f,g,h){for(var i,j=h?f:f.parentNode;j;){if(i=j.parentNode,i===g){return j}j=i}return null}function aW(e){var f=e.nodeType;return 3==f||4==f||8==f}function aY(e){if(!e){return !1}var f=e.nodeType;return 3==f||8==f}function a0(e,f){var g=f.nextSibling,h=f.parentNode;return g?h.insertBefore(e,g):h.appendChild(e),e}function a2(e,h,i){var j=e.cloneNode(!1);if(j.deleteData(0,h),e.deleteData(h,e.length-h),a0(j,e),i){for(var k,l=0;k=i[l++];){k.node==e&&k.offset>h?(k.node=j,k.offset-=h):k.node==e.parentNode&&k.offset>aK(e)&&++k.offset}}return j}function a3(b){if(9==b.nodeType){return b}if(typeof b.ownerDocument!=aN){return b.ownerDocument}if(typeof b.document!=aN){return b.document}if(b.parentNode){return a3(b.parentNode)}throw aE.createError("getDocument: no document found for node")}function a4(b){var e=a3(b);if(typeof e.defaultView!=aN){return e.defaultView}if(typeof e.parentWindow!=aN){return e.parentWindow}throw aE.createError("Cannot get a window object for node")}function a5(b){if(typeof b.contentDocument!=aN){return b.contentDocument}if(typeof b.contentWindow!=aN){return b.contentWindow.document}throw aE.createError("getIframeDocument: No Document object found for iframe element")}function a6(b){if(typeof b.contentWindow!=aN){return b.contentWindow}if(typeof b.contentDocument!=aN){return b.contentDocument.defaultView}throw aE.createError("getIframeWindow: No Window object found for iframe element")}function a7(b){return b&&aP.isHostMethod(b,"setTimeout")&&aP.isHostObject(b,"document")}function a8(e,f,g){var h;if(e?aP.isHostProperty(e,"nodeType")?h=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?a5(e):a3(e):a7(e)&&(h=e.document):h=document,!h){throw f.createError(g+"(): Parameter must be a Window object or DOM node")}return h}function a9(e){for(var f;f=e.parentNode;){e=f}return e}function ba(b,e,g,j){var n,o,p,q,r;if(b==g){return e===j?0:j>e?-1:1}if(n=aU(g,b,!0)){return e<=aK(n)?-1:1}if(n=aU(b,g,!0)){return aK(n)<j?-1:1}if(o=aO(b,g),!o){throw new Error("comparePoints error: nodes have no common ancestor")}if(p=b===o?o:aU(b,o,!0),q=g===o?o:aU(g,o,!0),p===q){throw aE.createError("comparePoints got to case 4 and childA and childB are the same!")}for(r=o.firstChild;r;){if(r===p){return -1}if(r===q){return 1}r=r.nextSibling}}function bb(e){var f;try{return f=e.parentNode,!1}catch(g){return !0}}function bc(e){if(!e){return"[No node]"}if(aZ&&bb(e)){return"[Broken node]"}if(aW(e)){return'"'+e.data+'"'}if(1==e.nodeType){var f=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+f+">[index:"+aK(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function bd(e){for(var f,g=a3(e).createDocumentFragment();f=e.firstChild;){g.appendChild(f)}return g}function be(g,h,i){var j=aR(g),k=g.createElement("div");k.contentEditable=""+!!i,h&&(k.innerHTML=h);var l=j.firstChild;return l?j.insertBefore(k,l):j.appendChild(k),k}function aD(b){return b.parentNode.removeChild(b)}function aF(b){this.root=b,this._next=b}function aH(b){return new aF(b)}function aJ(e,f){this.node=e,this.offset=f}function aL(b){this.code=this[b],this.codeName=b,this.message="DOMException: "+this.codeName}var aN="undefined",aP=N.util,aR=aP.getBody;aP.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||aE.fail("document missing a Node creation method"),aP.isHostMethod(document,"getElementsByTagName")||aE.fail("document missing getElementsByTagName method");var aT=document.createElement("div");aP.areHostMethods(aT,["insertBefore","appendChild","cloneNode"]||!aP.areHostObjects(aT,["previousSibling","nextSibling","childNodes","parentNode"]))||aE.fail("Incomplete Element implementation"),aP.isHostProperty(aT,"innerHTML")||aE.fail("Element is missing innerHTML property");var aV=document.createTextNode("test");aP.areHostMethods(aV,["splitText","deleteData","insertData","appendData","cloneNode"]||!aP.areHostObjects(aT,["previousSibling","nextSibling","childNodes","parentNode"])||!aP.areHostProperties(aV,["data"]))||aE.fail("Incomplete Text Node implementation");var aX=function(e,f){for(var g=e.length;g--;){if(e[g]===f){return !0}}return !1},aZ=!1;!function(){var a=document.createElement("b");a.innerHTML="1";var e=a.firstChild;a.innerHTML="<br />",aZ=bb(e),N.features.crashyTextNodes=aZ}();var a1;typeof window.getComputedStyle!=aN?a1=function(e,f){return a4(e).getComputedStyle(e,null)[f]}:typeof document.documentElement.currentStyle!=aN?a1=function(e,f){return e.currentStyle?e.currentStyle[f]:""}:aE.fail("No means of obtaining computed style properties found"),aF.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var e,f,g=this._current=this._next;if(this._current){if(e=g.firstChild){this._next=e}else{for(f=null;g!==this.root&&!(f=g.nextSibling);){g=g.parentNode}this._next=f}}return this._current},detach:function(){this._current=this._next=this.root=null}},aJ.prototype={equals:function(b){return !!b&&this.node===b.node&&this.offset==b.offset},inspect:function(){return"[DomPosition("+bc(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},aL.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},aL.prototype.toString=function(){return this.message},N.dom={arrayContains:aX,isHtmlNamespace:aG,parentElement:aI,getNodeIndex:aK,getNodeLength:aM,getCommonAncestor:aO,isAncestorOf:aQ,isOrIsAncestorOf:aS,getClosestAncestorIn:aU,isCharacterDataNode:aW,isTextOrCommentNode:aY,insertAfter:a0,splitDataNode:a2,getDocument:a3,getWindow:a4,getIframeWindow:a6,getIframeDocument:a5,getBody:aR,isWindow:a7,getContentDocument:a8,getRootContainer:a9,comparePoints:ba,isBrokenNode:bb,inspectNode:bc,getComputedStyleProperty:a1,createTestElement:be,removeNode:aD,fragmentFromNodeChildren:bd,createIterator:aH,DomPosition:aJ},N.DOMException=aL}),ad.createCoreModule("DomRange",["DomUtil"],function(aF,aI){function aL(e,f){return 3!=e.nodeType&&(bq(e,f.startContainer)||bq(e,f.endContainer))}function aO(b){return b.document||bt(b.startContainer)}function aR(b){return bH(b.startContainer)}function aU(b){return new be(b.parentNode,bn(b))}function aX(b){return new be(b.parentNode,bn(b)+1)}function a0(e,f,g){var h=11==e.nodeType?e.firstChild:e;return bk(f)?g==f.length?a7.insertAfter(e,f):f.parentNode.insertBefore(e,0==g?f:bz(f,g)):g>=f.childNodes.length?f.appendChild(e):f.insertBefore(e,f.childNodes[g]),h}function a3(g,h,i){if(bM(g),bM(h),aO(h)!=aO(g)){throw new bh("WRONG_DOCUMENT_ERR")}var j=bw(g.startContainer,g.startOffset,h.endContainer,h.endOffset),k=bw(g.endContainer,g.endOffset,h.startContainer,h.startOffset);return i?0>=j&&k>=0:0>j&&k>0}function a6(g){for(var h,i,j,k=aO(g.range).createDocumentFragment();i=g.next();){if(h=g.isPartiallySelectedSubtree(),i=i.cloneNode(!h),h&&(j=g.getSubtreeIterator(),i.appendChild(a6(j)),j.detach()),10==i.nodeType){throw new bh("HIERARCHY_REQUEST_ERR")}k.appendChild(i)}return k}function a9(h,i,j){var k,l;j=j||{stop:!1};for(var m,n;m=h.next();){if(h.isPartiallySelectedSubtree()){if(i(m)===!1){return void (j.stop=!0)}if(n=h.getSubtreeIterator(),a9(n,i,j),n.detach(),j.stop){return}}else{for(k=a7.createIterator(m);l=k.next();){if(i(l)===!1){return void (j.stop=!0)}}}}}function bd(e){for(var f;e.next();){e.isPartiallySelectedSubtree()?(f=e.getSubtreeIterator(),bd(f),f.detach()):e.remove()}}function bg(f){for(var g,h,i=aO(f.range).createDocumentFragment();g=f.next();){if(f.isPartiallySelectedSubtree()?(g=g.cloneNode(!1),h=f.getSubtreeIterator(),g.appendChild(bg(h)),h.detach()):f.remove(),10==g.nodeType){throw new bh("HIERARCHY_REQUEST_ERR")}i.appendChild(g)}return i}function bj(h,i,j){var k,l=!(!i||!i.length),m=!!j;l&&(k=new RegExp("^("+i.join("|")+")$"));var n=[];return a9(new bp(h,!1),function(a){if((!l||k.test(a.nodeType))&&(!m||j(a))){var e=h.startContainer;if(a!=e||!bk(e)||h.startOffset!=e.length){var f=h.endContainer;a==f&&bk(f)&&0==h.endOffset||n.push(a)}}}),n}function bm(e){var f="undefined"==typeof e.getName?"Range":e.getName();return"["+f+"("+a7.inspectNode(e.startContainer)+":"+e.startOffset+", "+a7.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function bp(e,f){if(this.range=e,this.clonePartiallySelectedTextNodes=f,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var g=e.commonAncestorContainer;this.sc===this.ec&&bk(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==g||bk(this.sc)?bB(this.sc,g,!0):this.sc.childNodes[this.so],this._last=this.ec!==g||bk(this.ec)?bB(this.ec,g,!0):this.ec.childNodes[this.eo-1])}}function bs(b){return function(a,f){for(var g,h=f?a:a.parentNode;h;){if(g=h.nodeType,bF(b,g)){return h}h=h.parentNode}return null}}function bv(e,f){if(aT(e,f)){throw new bh("INVALID_NODE_TYPE_ERR")}}function by(e,f){if(!bF(f,e.nodeType)){throw new bh("INVALID_NODE_TYPE_ERR")}}function bA(e,f){if(0>f||f>(bk(e)?e.length:e.childNodes.length)){throw new bh("INDEX_SIZE_ERR")}}function bC(e,f){if(aN(e,!0)!==aN(f,!0)){throw new bh("WRONG_DOCUMENT_ERR")}}function bE(b){if(aQ(b,!0)){throw new bh("NO_MODIFICATION_ALLOWED_ERR")}}function bG(e,f){if(!e){throw new bh(f)}}function bI(e,f){return f<=(bk(e)?e.length:e.childNodes.length)}function bK(b){return !!b.startContainer&&!!b.endContainer&&!(bJ&&(a7.isBrokenNode(b.startContainer)||a7.isBrokenNode(b.endContainer)))&&bH(b.startContainer)==bH(b.endContainer)&&bI(b.startContainer,b.startOffset)&&bI(b.endContainer,b.endOffset)}function bM(b){if(!bK(b)){throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+b.inspect()+")")}}function aG(h,i){bM(h);var j=h.startContainer,k=h.startOffset,l=h.endContainer,m=h.endOffset,n=j===l;bk(l)&&m>0&&m<l.length&&bz(l,m,i),bk(j)&&k>0&&k<j.length&&(j=bz(j,k,i),n?(m-=k,l=j):l==j.parentNode&&m>=bn(j)&&m++,k=0),h.setStartAndEnd(j,k,l,m)}function aJ(e){bM(e);var f=e.commonAncestorContainer.parentNode.cloneNode(!1);return f.appendChild(e.cloneContents()),f.innerHTML}function aM(b){b.START_TO_START=bc,b.START_TO_END=bf,b.END_TO_END=bi,b.END_TO_START=bl,b.NODE_BEFORE=bo,b.NODE_AFTER=br,b.NODE_BEFORE_AND_AFTER=bu,b.NODE_INSIDE=bx}function aP(b){aM(b),aM(b.prototype)}function aS(e,f){return function(){bM(this);var a,b,g=this.startContainer,k=this.startOffset,l=this.commonAncestorContainer,m=new bp(this,!0);g!==l&&(a=bB(g,l,!0),b=aX(a),g=b.node,k=b.offset),a9(m,bE),m.reset();var n=e(m);return m.detach(),f(this,g,k,g,k),n}}function aV(a,f){function g(e,h){return function(b){by(b,bN),by(bH(b),aD);var i=(e?aU:aX)(b);(h?k:l)(this,i.node,i.offset)}}function k(h,i,j){var n=h.endContainer,o=h.endOffset;(i!==h.startContainer||j!==h.startOffset)&&((bH(i)!=bH(n)||1==bw(i,j,n,o))&&(n=i,o=j),f(h,i,j,n,o))}function l(h,i,j){var n=h.startContainer,o=h.startOffset;(i!==h.endContainer||j!==h.endOffset)&&((bH(i)!=bH(n)||-1==bw(i,j,n,o))&&(n=i,o=j),f(h,n,o,i,j))}var m=function(){};m.prototype=aF.rangePrototype,a.prototype=new m,bb.extend(a.prototype,{setStart:function(e,h){bv(e,!0),bA(e,h),k(this,e,h)},setEnd:function(e,h){bv(e,!0),bA(e,h),l(this,e,h)},setStartAndEnd:function(){var h=arguments,i=h[0],j=h[1],n=i,o=j;switch(h.length){case 3:o=h[2];break;case 4:n=h[2],o=h[3]}f(this,i,j,n,o)},setBoundary:function(e,h,i){this["set"+(i?"Start":"End")](e,h)},setStartBefore:g(!0,!0),setStartAfter:g(!1,!0),setEndBefore:g(!0,!1),setEndAfter:g(!1,!1),collapse:function(b){bM(this),b?f(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):f(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(b){bv(b,!0),f(this,b,0,b,bD(b))},selectNode:function(e){bv(e,!1),by(e,bN);var h=aU(e),i=aX(e);f(this,h.node,h.offset,i.node,i.offset)},extractContents:aS(bg,f),deleteContents:aS(bd,f),canSurroundContents:function(){bM(this),bE(this.startContainer),bE(this.endContainer);var e=new bp(this,!0),h=e._first&&aL(e._first,this)||e._last&&aL(e._last,this);return e.detach(),!h},splitBoundaries:function(){aG(this)},splitBoundariesPreservingPositions:function(b){aG(this,b)},normalizeBoundaries:function(){bM(this);var n,o=this.startContainer,p=this.startOffset,q=this.endContainer,r=this.endOffset,s=function(e){var h=e.nextSibling;h&&h.nodeType==e.nodeType&&(q=e,r=e.length,e.appendData(h.data),bL(h))},t=function(b){var e=b.previousSibling;if(e&&e.nodeType==b.nodeType){o=b;var i=b.length;if(p=e.length,b.insertData(0,e.data),bL(e),o==q){r+=p,q=o}else{if(q==b.parentNode){var j=bn(b);r==j?(q=b,r=i):r>j&&r--}}}},u=!0;if(bk(q)){r==q.length?s(q):0==r&&(n=q.previousSibling,n&&n.nodeType==q.nodeType&&(r=n.length,o==q&&(u=!1),n.appendData(q.data),bL(q),q=n))}else{if(r>0){var v=q.childNodes[r-1];v&&bk(v)&&s(v)}u=!this.collapsed}if(u){if(bk(o)){0==p?t(o):p==o.length&&(n=o.nextSibling,n&&n.nodeType==o.nodeType&&(q==n&&(q=o,r+=o.length),o.appendData(n.data),bL(n)))}else{if(p<o.childNodes.length){var w=o.childNodes[p];w&&bk(w)&&t(w)}}}else{o=q,p=r}f(this,o,p,q,r)},collapseToPoint:function(e,h){bv(e,!0),bA(e,h),this.setStartAndEnd(e,h)}}),aP(a)}function aY(b){b.collapsed=b.startContainer===b.endContainer&&b.startOffset===b.endOffset,b.commonAncestorContainer=b.collapsed?b.startContainer:a7.getCommonAncestor(b.startContainer,b.endContainer)}function a1(f,g,h,i,j){f.startContainer=g,f.startOffset=h,f.endContainer=i,f.endOffset=j,f.document=a7.getDocument(g),aY(f)}function a4(b){this.startContainer=b,this.startOffset=0,this.endContainer=b,this.endOffset=0,this.document=b,aY(this)}var a7=aF.dom,bb=aF.util,be=a7.DomPosition,bh=aF.DOMException,bk=a7.isCharacterDataNode,bn=a7.getNodeIndex,bq=a7.isOrIsAncestorOf,bt=a7.getDocument,bw=a7.comparePoints,bz=a7.splitDataNode,bB=a7.getClosestAncestorIn,bD=a7.getNodeLength,bF=a7.arrayContains,bH=a7.getRootContainer,bJ=aF.features.crashyTextNodes,bL=a7.removeNode;bp.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return !!this._next},next:function(){var b=this._current=this._next;return b&&(this._next=b!==this._last?b.nextSibling:null,bk(b)&&this.clonePartiallySelectedTextNodes&&(b===this.ec&&(b=b.cloneNode(!0)).deleteData(this.eo,b.length-this.eo),this._current===this.sc&&(b=b.cloneNode(!0)).deleteData(0,this.so))),b},remove:function(){var e,f,g=this._current;!bk(g)||g!==this.sc&&g!==this.ec?g.parentNode&&bL(g):(e=g===this.sc?this.so:0,f=g===this.ec?this.eo:g.length,e!=f&&g.deleteData(e,f-e))},isPartiallySelectedSubtree:function(){var b=this._current;return aL(b,this.range)},getSubtreeIterator:function(){var h;if(this.isSingleCharacterDataNode){h=this.range.cloneRange(),h.collapse(!1)}else{h=new a4(aO(this.range));var i=this._current,j=i,k=0,l=i,m=bD(i);bq(i,this.sc)&&(j=this.sc,k=this.so),bq(i,this.ec)&&(l=this.ec,m=this.eo),a1(h,j,k,l,m)}return new bp(h,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var bN=[1,3,4,5,7,8,10],aD=[2,9,11],aE=[5,6,10,12],aH=[1,3,4,5,7,8,10,11],aK=[1,3,4,5,7,8],aN=bs([9,11]),aQ=bs(aE),aT=bs([6,10,12]),aW=document.createElement("style"),aZ=!1;try{aW.innerHTML="<b>x</b>",aZ=3==aW.firstChild.nodeType}catch(a2){}aF.features.htmlParsingConforms=aZ;var a5=aZ?function(e){var f=this.startContainer,g=bt(f);if(!f){throw new bh("INVALID_STATE_ERR")}var h=null;return 1==f.nodeType?h=f:bk(f)&&(h=a7.parentElement(f)),h=null===h||"HTML"==h.nodeName&&a7.isHtmlNamespace(bt(h).documentElement)&&a7.isHtmlNamespace(h)?g.createElement("body"):h.cloneNode(!1),h.innerHTML=e,a7.fragmentFromNodeChildren(h)}:function(e){var f=aO(this),g=f.createElement("body");return g.innerHTML=e,a7.fragmentFromNodeChildren(g)},a8=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],bc=0,bf=1,bi=2,bl=3,bo=0,br=1,bu=2,bx=3;bb.extend(aF.rangePrototype,{compareBoundaryPoints:function(i,j){bM(this),bC(this.startContainer,j.startContainer);var k,l,m,n,o=i==bl||i==bc?"start":"end",p=i==bf||i==bc?"start":"end";return k=this[o+"Container"],l=this[o+"Offset"],m=j[p+"Container"],n=j[p+"Offset"],bw(k,l,m,n)},insertNode:function(e){if(bM(this),by(e,aH),bE(this.startContainer),bq(e,this.startContainer)){throw new bh("HIERARCHY_REQUEST_ERR")}var f=a0(e,this.startContainer,this.startOffset);this.setStartBefore(f)},cloneContents:function(){bM(this);var e,f;if(this.collapsed){return aO(this).createDocumentFragment()}if(this.startContainer===this.endContainer&&bk(this.startContainer)){return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),f=aO(this).createDocumentFragment(),f.appendChild(e),f}var g=new bp(this,!0);return e=a6(g),g.detach(),e},canSurroundContents:function(){bM(this),bE(this.startContainer),bE(this.endContainer);var e=new bp(this,!0),f=e._first&&aL(e._first,this)||e._last&&aL(e._last,this);return e.detach(),!f},surroundContents:function(e){if(by(e,aK),!this.canSurroundContents()){throw new bh("INVALID_STATE_ERR")}var f=this.extractContents();if(e.hasChildNodes()){for(;e.lastChild;){e.removeChild(e.lastChild)}}a0(e,this.startContainer,this.startOffset),e.appendChild(f),this.selectNode(e)},cloneRange:function(){bM(this);for(var e,f=new a4(aO(this)),g=a8.length;g--;){e=a8[g],f[e]=this[e]}return f},toString:function(){bM(this);var e=this.startContainer;if(e===this.endContainer&&bk(e)){return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):""}var f=[],g=new bp(this,!0);return a9(g,function(b){(3==b.nodeType||4==b.nodeType)&&f.push(b.data)}),g.detach(),f.join("")},compareNode:function(f){bM(this);var g=f.parentNode,h=bn(f);if(!g){throw new bh("NOT_FOUND_ERR")}var i=this.comparePoint(g,h),j=this.comparePoint(g,h+1);return 0>i?j>0?bu:bo:j>0?br:bx},comparePoint:function(e,f){return bM(this),bG(e,"HIERARCHY_REQUEST_ERR"),bC(e,this.startContainer),bw(e,f,this.startContainer,this.startOffset)<0?-1:bw(e,f,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:a5,toHtml:function(){return aJ(this)},intersectsNode:function(e,h){if(bM(this),bH(e)!=aR(this)){return !1}var i=e.parentNode,j=bn(e);if(!i){return !0}var k=bw(i,j,this.endContainer,this.endOffset),l=bw(i,j+1,this.startContainer,this.startOffset);return h?0>=k&&l>=0:0>k&&l>0},isPointInRange:function(e,f){return bM(this),bG(e,"HIERARCHY_REQUEST_ERR"),bC(e,this.startContainer),bw(e,f,this.startContainer,this.startOffset)>=0&&bw(e,f,this.endContainer,this.endOffset)<=0},intersectsRange:function(b){return a3(this,b,!1)},intersectsOrTouchesRange:function(b){return a3(this,b,!0)},intersection:function(e){if(this.intersectsRange(e)){var f=bw(this.startContainer,this.startOffset,e.startContainer,e.startOffset),g=bw(this.endContainer,this.endOffset,e.endContainer,e.endOffset),h=this.cloneRange();return -1==f&&h.setStart(e.startContainer,e.startOffset),1==g&&h.setEnd(e.endContainer,e.endOffset),h}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var f=this.cloneRange();return -1==bw(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&f.setStart(e.startContainer,e.startOffset),1==bw(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&f.setEnd(e.endContainer,e.endOffset),f}throw new bh("Ranges do not intersect")},containsNode:function(e,f){return f?this.intersectsNode(e,!1):this.compareNode(e)==bx},containsNodeContents:function(b){return this.comparePoint(b,0)>=0&&this.comparePoint(b,bD(b))<=0},containsRange:function(e){var f=this.intersection(e);return null!==f&&e.equals(f)},containsNodeText:function(e){var f=this.cloneRange();f.selectNode(e);var g=f.getNodes([3]);if(g.length>0){f.setStart(g[0],0);var h=g.pop();return f.setEnd(h,h.length),this.containsRange(f)}return this.containsNodeContents(e)},getNodes:function(e,f){return bM(this),bj(this,e,f)},getDocument:function(){return aO(this)},collapseBefore:function(b){this.setEndBefore(b),this.collapse(!1)},collapseAfter:function(b){this.setStartAfter(b),this.collapse(!0)},getBookmark:function(a){var i=aO(this),j=aF.createRange(i);a=a||a7.getBody(i),j.selectNodeContents(a);var k=this.intersection(j),l=0,m=0;return k&&(j.setEnd(k.startContainer,k.startOffset),l=j.toString().length,m=l+k.toString().length),{start:l,end:m,containerNode:a}},moveToBookmark:function(k){var l=k.containerNode,m=0;this.setStart(l,0),this.collapse(!0);for(var n,o,p,q,r=[l],s=!1,t=!1;!t&&(n=r.pop());){if(3==n.nodeType){o=m+n.length,!s&&k.start>=m&&k.start<=o&&(this.setStart(n,k.start-m),s=!0),s&&k.end>=m&&k.end<=o&&(this.setEnd(n,k.end-m),t=!0),m=o}else{for(q=n.childNodes,p=q.length;p--;){r.push(q[p])}}}},getName:function(){return"DomRange"},equals:function(b){return a4.rangesEqual(this,b)},isValid:function(){return bK(this)},inspect:function(){return bm(this)},detach:function(){}}),aV(a4,a1),bb.extend(a4,{rangeProperties:a8,RangeIterator:bp,copyComparisonConstants:aP,createPrototypeRange:aV,inspect:bm,toHtml:aJ,getRangeDocument:aO,rangesEqual:function(e,f){return e.startContainer===f.startContainer&&e.startOffset===f.startOffset&&e.endContainer===f.endContainer&&e.endOffset===f.endOffset}}),aF.DomRange=a4}),ad.createCoreModule("WrappedRange",["DomRange"],function(r,s){var t,u,v=r.dom,w=r.util,x=v.DomPosition,y=r.DomRange,z=v.getBody,A=v.getContentDocument,B=v.isCharacterDataNode;if(r.features.implementsDomRange&&!function(){function a(g){for(var k,l=h.length;l--;){k=h[l],g[k]=g.nativeRange[k]}g.collapsed=g.startContainer===g.endContainer&&g.startOffset===g.endOffset}function b(k,l,m,n,o){var p=k.startContainer!==l||k.startOffset!=m,q=k.endContainer!==n||k.endOffset!=o,N=!k.equals(k.nativeRange);(p||q||N)&&(k.setEnd(n,o),k.setStart(l,m))}var e,f,h=y.rangeProperties;t=function(g){if(!g){throw s.createError("WrappedRange: Range must be specified")}this.nativeRange=g,a(this)},y.createPrototypeRange(t,b),e=t.prototype,e.selectNode=function(g){this.nativeRange.selectNode(g),a(this)},e.cloneContents=function(){return this.nativeRange.cloneContents()},e.surroundContents=function(g){this.nativeRange.surroundContents(g),a(this)},e.collapse=function(g){this.nativeRange.collapse(g),a(this)},e.cloneRange=function(){return new t(this.nativeRange.cloneRange())},e.refresh=function(){a(this)},e.toString=function(){return this.nativeRange.toString()};var i=document.createTextNode("test");z(document).appendChild(i);var j=document.createRange();j.setStart(i,0),j.setEnd(i,0);try{j.setStart(i,1),e.setStart=function(g,k){this.nativeRange.setStart(g,k),a(this)},e.setEnd=function(g,k){this.nativeRange.setEnd(g,k),a(this)},f=function(g){return function(k){this.nativeRange[g](k),a(this)}}}catch(I){e.setStart=function(g,k){try{this.nativeRange.setStart(g,k)}catch(l){this.nativeRange.setEnd(g,k),this.nativeRange.setStart(g,k)}a(this)},e.setEnd=function(g,k){try{this.nativeRange.setEnd(g,k)}catch(l){this.nativeRange.setStart(g,k),this.nativeRange.setEnd(g,k)}a(this)},f=function(g,k){return function(l){try{this.nativeRange[g](l)}catch(m){this.nativeRange[k](l),this.nativeRange[g](l)}a(this)}}}e.setStartBefore=f("setStartBefore","setEndBefore"),e.setStartAfter=f("setStartAfter","setEndAfter"),e.setEndBefore=f("setEndBefore","setStartBefore"),e.setEndAfter=f("setEndAfter","setStartAfter"),e.selectNodeContents=function(g){this.setStartAndEnd(g,0,v.getNodeLength(g))},j.selectNodeContents(i),j.setEnd(i,3);var J=document.createRange();J.selectNodeContents(i),J.setEnd(i,4),J.setStart(i,2),-1==j.compareBoundaryPoints(j.START_TO_END,J)&&1==j.compareBoundaryPoints(j.END_TO_START,J)?e.compareBoundaryPoints=function(g,k){return k=k.nativeRange||k,g==k.START_TO_END?g=k.END_TO_START:g==k.END_TO_START&&(g=k.START_TO_END),this.nativeRange.compareBoundaryPoints(g,k)}:e.compareBoundaryPoints=function(g,k){return this.nativeRange.compareBoundaryPoints(g,k.nativeRange||k)};var K=document.createElement("div");K.innerHTML="123";var L=K.firstChild,M=z(document);M.appendChild(K),j.setStart(L,1),j.setEnd(L,2),j.deleteContents(),"13"==L.data&&(e.deleteContents=function(){this.nativeRange.deleteContents(),a(this)},e.extractContents=function(){var g=this.nativeRange.extractContents();return a(this),g}),M.removeChild(K),M=null,w.isHostMethod(j,"createContextualFragment")&&(e.createContextualFragment=function(g){return this.nativeRange.createContextualFragment(g)}),z(document).removeChild(i),e.getName=function(){return"WrappedRange"},r.WrappedRange=t,r.createNativeRange=function(g){return g=A(g,s,"createNativeRange"),g.createRange()}}(),r.features.implementsTextRange){var C=function(e){var h=e.parentElement(),i=e.duplicate();i.collapse(!0);var j=i.parentElement();i=e.duplicate(),i.collapse(!1);var k=i.parentElement(),l=j==k?j:v.getCommonAncestor(j,k);return l==h?l:v.getCommonAncestor(h,l)},D=function(b){return 0==b.compareEndPoints("StartToEnd",b)},E=function(e,g,k,I,J){var K=e.duplicate();K.collapse(k);var L=K.parentElement();if(v.isOrIsAncestorOf(g,L)||(L=g),!L.canHaveHTML){var M=new x(L.parentNode,v.getNodeIndex(L));return{boundaryPosition:M,nodeInfo:{nodeIndex:M.offset,containerElement:M.node}}}var N=v.getDocument(L).createElement("span");N.parentNode&&v.removeNode(N);for(var aD,aE,aF,aG,aH,aI=k?"StartToStart":"StartToEnd",aJ=J&&J.containerElement==L?J.nodeIndex:0,aK=L.childNodes.length,aL=aK,aM=aL;;){if(aM==aK?L.appendChild(N):L.insertBefore(N,L.childNodes[aM]),K.moveToElementText(N),aD=K.compareEndPoints(aI,e),0==aD||aJ==aL){break}if(-1==aD){if(aL==aJ+1){break}aJ=aM}else{aL=aL==aJ+1?aJ:aM}aM=Math.floor((aJ+aL)/2),L.removeChild(N)}if(aH=N.nextSibling,-1==aD&&aH&&B(aH)){K.setEndPoint(k?"EndToStart":"EndToEnd",e);var aN;if(/[\r\n]/.test(aH.data)){var aO=K.duplicate(),aP=aO.text.replace(/\r\n/g,"\r").length;for(aN=aO.moveStart("character",aP);-1==(aD=aO.compareEndPoints("StartToEnd",aO));){aN++,aO.moveStart("character",1)}}else{aN=K.text.length}aG=new x(aH,aN)}else{aE=(I||!k)&&N.previousSibling,aF=(I||k)&&N.nextSibling,aG=aF&&B(aF)?new x(aF,0):aE&&B(aE)?new x(aE,aE.data.length):new x(L,v.getNodeIndex(N))}return v.removeNode(N),{boundaryPosition:aG,nodeInfo:{nodeIndex:aM,containerElement:L}}},F=function(e,i){var k,n,o,p,q=e.offset,I=v.getDocument(e.node),J=z(I).createTextRange(),K=B(e.node);return K?(k=e.node,n=k.parentNode):(p=e.node.childNodes,k=q<p.length?p[q]:null,n=e.node),o=I.createElement("span"),o.innerHTML="&#feff;",k?n.insertBefore(o,k):n.appendChild(o),J.moveToElementText(o),J.collapse(!i),n.removeChild(o),K&&J[i?"moveStart":"moveEnd"]("character",q),J};u=function(b){this.textRange=b,this.refresh()},u.prototype=new y(document),u.prototype.refresh=function(){var e,f,g,h=C(this.textRange);D(this.textRange)?f=e=E(this.textRange,h,!0,!0).boundaryPosition:(g=E(this.textRange,h,!0,!1),e=g.boundaryPosition,f=E(this.textRange,h,!1,!1,g.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(f.node,f.offset)},u.prototype.getName=function(){return"WrappedTextRange"},y.copyComparisonConstants(u);var G=function(e){if(e.collapsed){return F(new x(e.startContainer,e.startOffset),!0)}var f=F(new x(e.startContainer,e.startOffset),!0),g=F(new x(e.endContainer,e.endOffset),!1),h=z(y.getRangeDocument(e)).createTextRange();return h.setEndPoint("StartToStart",f),h.setEndPoint("EndToEnd",g),h};if(u.rangeToTextRange=G,u.prototype.toTextRange=function(){return G(this)},r.WrappedTextRange=u,!r.features.implementsDomRange||r.config.preferTextRange){var H=function(b){return b("return this;")()}(Function);"undefined"==typeof H.Range&&(H.Range=u),r.createNativeRange=function(b){return b=A(b,s,"createNativeRange"),z(b).createTextRange()},r.WrappedRange=u}}r.createRange=function(a){return a=A(a,s,"createRange"),new r.WrappedRange(r.createNativeRange(a))},r.createRangyRange=function(b){return b=A(b,s,"createRangyRange"),new y(b)},w.createAliasForDeprecatedMethod(r,"createIframeRange","createRange"),w.createAliasForDeprecatedMethod(r,"createIframeRangyRange","createRangyRange"),r.addShimListener(function(a){var e=a.document;"undefined"==typeof e.createRange&&(e.createRange=function(){return r.createRange(e)}),e=a=null})}),ad.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(aF,aI){function aL(b){return"string"==typeof b?/^backward(s)?$/i.test(b):!!b}function aO(b,e){if(b){if(aM.isWindow(b)){return b}if(b instanceof bm){return b.win}var f=aM.getContentDocument(b,aI,e);return aM.getWindow(f)}return window}function aR(b){return aO(b,"getWinSelection").getSelection()}function aU(b){return aO(b,"getDocSelection").document.selection}function aX(e){var f=!1;return e.anchorNode&&(f=1==aM.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),f}function a0(f,g,h){var i=h?"end":"start",j=h?"start":"end";f.anchorNode=g[i+"Container"],f.anchorOffset=g[i+"Offset"],f.focusNode=g[j+"Container"],f.focusOffset=g[j+"Offset"]}function a3(e){var f=e.nativeSelection;e.anchorNode=f.anchorNode,e.anchorOffset=f.anchorOffset,e.focusNode=f.focusNode,e.focusOffset=f.focusOffset}function a5(b){b.anchorNode=b.focusNode=null,b.anchorOffset=b.focusOffset=0,b.rangeCount=0,b.isCollapsed=!0,b._ranges.length=0}function a7(a){var e;return a instanceof aV?(e=aF.createNativeRange(a.getDocument()),e.setEnd(a.endContainer,a.endOffset),e.setStart(a.startContainer,a.startOffset)):a instanceof aY?e=a.nativeRange:a6.implementsDomRange&&a instanceof aM.getWindow(a.startContainer).Range&&(e=a),e}function a9(e){if(!e.length||1!=e[0].nodeType){return !1}for(var f=1,g=e.length;g>f;++f){if(!aM.isAncestorOf(e[0],e[f])){return !1}}return !0}function bc(b){var e=b.getNodes();if(!a9(e)){throw aI.createError("getSingleElementFromRange: range "+b.inspect()+" did not consist of a single element")}return e[0]}function be(b){return !!b&&"undefined"!=typeof b.text}function bg(e,f){var g=new aY(f);e._ranges=[g],a0(e,g,!1),e.rangeCount=1,e.isCollapsed=g.collapsed}function bi(a){if(a._ranges.length=0,"None"==a.docSelection.type){a5(a)}else{var g=a.docSelection.createRange();if(be(g)){bg(a,g)}else{a.rangeCount=g.length;for(var h,i=bb(g.item(0)),j=0;j<a.rangeCount;++j){h=aF.createRange(i),h.selectNode(g.item(j)),a._ranges.push(h)}a.isCollapsed=1==a.rangeCount&&a._ranges[0].collapsed,a0(a,a._ranges[a.rangeCount-1],!1)}}}function bk(b,k){for(var l=b.docSelection.createRange(),m=bc(k),n=bb(l.item(0)),o=bd(n).createControlRange(),p=0,q=l.length;q>p;++p){o.add(l.item(p))}try{o.add(m)}catch(r){throw aI.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}o.select(),bi(b)}function bm(e,f,g){this.nativeSelection=e,this.docSelection=f,this._ranges=[],this.win=g,this.refresh()}function bo(b){b.win=b.anchorNode=b.focusNode=b._ranges=null,b.rangeCount=b.anchorOffset=b.focusOffset=0,b.detached=!0}function bq(f,g){for(var h,i,j=aK.length;j--;){if(h=aK[j],i=h.selection,"deleteAll"==g){bo(i)}else{if(h.win==f){return"delete"==g?(aK.splice(j,1),!0):i}}}return"deleteAll"==g&&(aK.length=0),null}function bs(b,j){for(var k,l=bb(j[0].startContainer),m=bd(l).createControlRange(),n=0,o=j.length;o>n;++n){k=bc(j[n]);try{m.add(k)}catch(p){throw aI.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}m.select(),bi(b)}function bu(e,f){if(e.win.document!=bb(f)){throw new a1("WRONG_DOCUMENT_ERR")}}function bw(a){return function(b,f){var g;this.rangeCount?(g=this.getRangeAt(0),g["set"+(a?"Start":"End")](b,f)):(g=aF.createRange(this.win.document),g.setStartAndEnd(b,f)),this.setSingleRange(g,this.isBackward())}}function by(h){var i=[],j=new a4(h.anchorNode,h.anchorOffset),k=new a4(h.focusNode,h.focusOffset),l="function"==typeof h.getName?h.getName():"Selection";if("undefined"!=typeof h.rangeCount){for(var m=0,n=h.rangeCount;n>m;++m){i[m]=aV.inspect(h.getRangeAt(m))}}return"["+l+"(Ranges: "+i.join(", ")+")(anchor: "+j.inspect()+", focus: "+k.inspect()+"]"}aF.config.checkSelectionRanges=!0;var bA,bC,aG="boolean",aJ="number",aM=aF.dom,aP=aF.util,aS=aP.isHostMethod,aV=aF.DomRange,aY=aF.WrappedRange,a1=aF.DOMException,a4=aM.DomPosition,a6=aF.features,a8="Control",bb=aM.getDocument,bd=aM.getBody,bf=aV.rangesEqual,bh=aS(window,"getSelection"),bj=aP.isHostObject(document,"selection");a6.implementsWinGetSelection=bh,a6.implementsDocSelection=bj;var bl=bj&&(!bh||aF.config.preferTextRange);if(bl){bA=aU,aF.isSelectionValid=function(e){var f=aO(e,"isSelectionValid").document,g=f.selection;return"None"!=g.type||bb(g.createRange().parentElement())==f}}else{if(!bh){return aI.fail("Neither document.selection or window.getSelection() detected."),!1}bA=aR,aF.isSelectionValid=function(){return !0}}aF.getNativeSelection=bA;var bn=bA();if(!bn){return aI.fail("Native selection was null (possibly issue 138?)"),!1}var bp=aF.createNativeRange(document),br=bd(document),bt=aP.areHostProperties(bn,["anchorNode","focusNode","anchorOffset","focusOffset"]);a6.selectionHasAnchorAndFocus=bt;var bv=aS(bn,"extend");a6.selectionHasExtend=bv;var bx=typeof bn.rangeCount==aJ;a6.selectionHasRangeCount=bx;var bz=!1,bB=!0,bD=bv?function(a,f){var g=aV.getRangeDocument(f),h=aF.createRange(g);h.collapseToPoint(f.endContainer,f.endOffset),a.addRange(a7(h)),a.extend(f.startContainer,f.startOffset)}:null;aP.areHostMethods(bn,["addRange","getRangeAt","removeAllRanges"])&&typeof bn.rangeCount==aJ&&a6.implementsDomRange&&!function(){var a=window.getSelection();if(a){for(var g=a.rangeCount,n=g>1,o=[],p=aX(a),q=0;g>q;++q){o[q]=a.getRangeAt(q)}var r=aM.createTestElement(document,"",!1),s=r.appendChild(document.createTextNode("   ")),t=document.createRange();if(t.setStart(s,1),t.collapse(!0),a.removeAllRanges(),a.addRange(t),bB=1==a.rangeCount,a.removeAllRanges(),!n){var u=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(u&&parseInt(u[1])>=36){bz=!1}else{var v=t.cloneRange();t.setStart(s,0),v.setEnd(s,3),v.setStart(s,2),a.addRange(t),a.addRange(v),bz=2==a.rangeCount}}for(aM.removeNode(r),a.removeAllRanges(),q=0;g>q;++q){0==q&&p?bD?bD(a,o[q]):(aF.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),a.addRange(o[q])):a.addRange(o[q])}}}(),a6.selectionSupportsMultipleRanges=bz,a6.collapsedNonEditableSelectionsSupported=bB;var aD,aE=!1;br&&aS(br,"createControlRange")&&(aD=br.createControlRange(),aP.areHostProperties(aD,["item","add"])&&(aE=!0)),a6.implementsControlRange=aE,bC=bt?function(b){return b.anchorNode===b.focusNode&&b.anchorOffset===b.focusOffset}:function(b){return b.rangeCount?b.getRangeAt(b.rangeCount-1).collapsed:!1};var aH;aS(bn,"getRangeAt")?aH=function(e,f){try{return e.getRangeAt(f)}catch(g){return null}}:bt&&(aH=function(a){var e=bb(a.anchorNode),f=aF.createRange(e);return f.setStartAndEnd(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),f.collapsed!==this.isCollapsed&&f.setStartAndEnd(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset),f}),bm.prototype=aF.selectionPrototype;var aK=[],aN=function(f){if(f&&f instanceof bm){return f.refresh(),f}f=aO(f,"getNativeSelection");var g=bq(f),h=bA(f),i=bj?aU(f):null;return g?(g.nativeSelection=h,g.docSelection=i,g.refresh()):(g=new bm(h,i,f),aK.push({win:f,selection:g})),g};aF.getSelection=aN,aP.createAliasForDeprecatedMethod(aF,"getIframeSelection","getSelection");var aQ=bm.prototype;if(!bl&&bt&&aP.areHostMethods(bn,["removeAllRanges","addRange"])){aQ.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),a5(this)};var aT=function(e,f){bD(e.nativeSelection,f),e.refresh()};bx?aQ.addRange=function(a,h){if(aE&&bj&&this.docSelection.type==a8){bk(this,a)}else{if(aL(h)&&bv){aT(this,a)}else{var j;bz?j=this.rangeCount:(this.removeAllRanges(),j=0);var k=a7(a).cloneRange();try{this.nativeSelection.addRange(k)}catch(l){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==j+1){if(aF.config.checkSelectionRanges){var m=aH(this.nativeSelection,this.rangeCount-1);m&&!bf(m,a)&&(a=new aY(m))}this._ranges[this.rangeCount-1]=a,a0(this,a,a2(this.nativeSelection)),this.isCollapsed=bC(this)}else{this.refresh()}}}}:aQ.addRange=function(e,f){aL(f)&&bv?aT(this,e):(this.nativeSelection.addRange(a7(e)),this.refresh())},aQ.setRanges=function(e){if(aE&&bj&&e.length>1){bs(this,e)}else{this.removeAllRanges();for(var f=0,g=e.length;g>f;++f){this.addRange(e[f])}}}}else{if(!(aS(bn,"empty")&&aS(bp,"select")&&aE&&bl)){return aI.fail("No means of selecting a Range or TextRange was found"),!1}aQ.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode){e=bb(this.anchorNode)}else{if(this.docSelection.type==a8){var f=this.docSelection.createRange();f.length&&(e=bb(f.item(0)))}}if(e){var g=bd(e).createTextRange();g.select(),this.docSelection.empty()}}}catch(h){}a5(this)},aQ.addRange=function(a){this.docSelection.type==a8?bk(this,a):(aF.WrappedTextRange.rangeToTextRange(a).select(),this._ranges[0]=a,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,a0(this,a,!1))},aQ.setRanges=function(e){this.removeAllRanges();var f=e.length;f>1?bs(this,e):f&&this.addRange(e[0])}}aQ.getRangeAt=function(b){if(0>b||b>=this.rangeCount){throw new a1("INDEX_SIZE_ERR")}return this._ranges[b].cloneRange()};var aW;if(bl){aW=function(a){var e;aF.isSelectionValid(a.win)?e=a.docSelection.createRange():(e=bd(a.win.document).createTextRange(),e.collapse(!0)),a.docSelection.type==a8?bi(a):be(e)?bg(a,e):a5(a)}}else{if(aS(bn,"getRangeAt")&&typeof bn.rangeCount==aJ){aW=function(a){if(aE&&bj&&a.docSelection.type==a8){bi(a)}else{if(a._ranges.length=a.rangeCount=a.nativeSelection.rangeCount,a.rangeCount){for(var e=0,f=a.rangeCount;f>e;++e){a._ranges[e]=new aF.WrappedRange(a.nativeSelection.getRangeAt(e))}a0(a,a._ranges[a.rangeCount-1],a2(a.nativeSelection)),a.isCollapsed=bC(a)}else{a5(a)}}}}else{if(!bt||typeof bn.isCollapsed!=aG||typeof bp.collapsed!=aG||!a6.implementsDomRange){return aI.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1}aW=function(e){var f,g=e.nativeSelection;g.anchorNode?(f=aH(g,0),e._ranges=[f],e.rangeCount=1,a3(e),e.isCollapsed=bC(e)):a5(e)}}}aQ.refresh=function(f){var g=f?this._ranges.slice(0):null,h=this.anchorNode,i=this.anchorOffset;if(aW(this),f){var j=g.length;if(j!=this._ranges.length){return !0}if(this.anchorNode!=h||this.anchorOffset!=i){return !0}for(;j--;){if(!bf(g[j],this._ranges[j])){return !0}}return !1}};var aZ=function(f,g){var h=f.getAllRanges();f.removeAllRanges();for(var i=0,j=h.length;j>i;++i){bf(g,h[i])||f.addRange(h[i])}f.rangeCount||a5(f)};aE&&bj?aQ.removeRange=function(j){if(this.docSelection.type==a8){for(var k,l=this.docSelection.createRange(),m=bc(j),n=bb(l.item(0)),o=bd(n).createControlRange(),p=!1,q=0,r=l.length;r>q;++q){k=l.item(q),k!==m||p?o.add(l.item(q)):p=!0}o.select(),bi(this)}else{aZ(this,j)}}:aQ.removeRange=function(b){aZ(this,b)};var a2;!bl&&bt&&a6.implementsDomRange?(a2=aX,aQ.isBackward=function(){return a2(this)}):a2=aQ.isBackward=function(){return !1},aQ.isBackwards=aQ.isBackward,aQ.toString=function(){for(var e=[],f=0,g=this.rangeCount;g>f;++f){e[f]=""+this._ranges[f]}return e.join("")},aQ.collapse=function(a,e){bu(this,a);var f=aF.createRange(a);f.collapseToPoint(a,e),this.setSingleRange(f),this.isCollapsed=!0},aQ.collapseToStart=function(){if(!this.rangeCount){throw new a1("INVALID_STATE_ERR")}var b=this._ranges[0];this.collapse(b.startContainer,b.startOffset)},aQ.collapseToEnd=function(){if(!this.rangeCount){throw new a1("INVALID_STATE_ERR")}var b=this._ranges[this.rangeCount-1];this.collapse(b.endContainer,b.endOffset)},aQ.selectAllChildren=function(a){bu(this,a);var e=aF.createRange(a);e.selectNodeContents(a),this.setSingleRange(e)},aQ.deleteFromDocument=function(){if(aE&&bj&&this.docSelection.type==a8){for(var f,g=this.docSelection.createRange();g.length;){f=g.item(0),g.remove(f),aM.removeNode(f)}this.refresh()}else{if(this.rangeCount){var h=this.getAllRanges();if(h.length){this.removeAllRanges();for(var i=0,j=h.length;j>i;++i){h[i].deleteContents()}this.addRange(h[j-1])}}}},aQ.eachRange=function(e,f){for(var g=0,h=this._ranges.length;h>g;++g){if(e(this.getRangeAt(g))){return f}}},aQ.getAllRanges=function(){var b=[];return this.eachRange(function(a){b.push(a)}),b},aQ.setSingleRange=function(e,f){this.removeAllRanges(),this.addRange(e,f)},aQ.callMethodOnEachRange=function(e,f){var g=[];return this.eachRange(function(a){g.push(a[e].apply(a,f||[]))}),g},aQ.setStart=bw(!0),aQ.setEnd=bw(!1),aF.rangePrototype.select=function(b){aN(this.getDocument()).setSingleRange(this,b)},aQ.changeEachRange=function(e){var f=[],g=this.isBackward();this.eachRange(function(a){e(a),f.push(a)}),this.removeAllRanges(),g&&1==f.length?this.addRange(f[0],"backward"):this.setRanges(f)},aQ.containsNode=function(e,f){return this.eachRange(function(a){return a.containsNode(e,f)},!0)||!1},aQ.getBookmark=function(b){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[b])}},aQ.moveToBookmark=function(a){for(var g,h,i=[],j=0;g=a.rangeBookmarks[j++];){h=aF.createRange(this.win),h.moveToBookmark(g),i.push(h)}a.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},aQ.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},aQ.restoreRanges=function(e){this.removeAllRanges();for(var f,g=0;f=e.ranges[g];++g){this.addRange(f,e.backward&&0==g)}},aQ.toHtml=function(){var b=[];return this.eachRange(function(a){b.push(aV.toHtml(a))}),b.join("")},a6.implementsTextRange&&(aQ.getNativeTextRange=function(){var a;if(a=this.docSelection){var b=a.createRange();if(be(b)){return b}throw aI.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0){return aF.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}throw aI.createError("getNativeTextRange: selection contains no range")}),aQ.getName=function(){return"WrappedSelection"},aQ.inspect=function(){return by(this)},aQ.detach=function(){bq(this.win,"delete"),bo(this)},bm.detachAll=function(){bq(null,"deleteAll")},bm.inspect=by,bm.isDirectionBackward=aL,aF.Selection=bm,aF.selectionPrototype=aQ,aF.addShimListener(function(b){"undefined"==typeof b.getSelection&&(b.getSelection=function(){return aN(b)}),b=null})});var an=!1,ap=function(b){an||(an=!0,!ad.initialized&&ad.config.autoInitialize&&ak())};return Z&&("complete"==document.readyState?ap():(O(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",ap,!1),ah(window,"load",ap))),ad},this),function(a,e){"function"==typeof define&&define.amd?define(["./rangy-core"],a):"undefined"!=typeof module&&"object"==typeof c?module.exports=a(require("rangy")):a(e.rangy)}(function(b){return b.createModule("SaveRestore",["WrappedRange"],function(s,t){function u(e,f){return(f||document).getElementById(e)}function v(g,h){var i,j="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),k=G.getDocument(g.startContainer),l=g.cloneRange();return l.collapse(h),i=k.createElement("span"),i.id=j,i.style.lineHeight="0",i.style.display="none",i.className="rangySelectionBoundary",i.appendChild(k.createTextNode(J)),l.insertNode(i),i}function w(h,i,j,k){var l=u(j,h);l?(i[k?"setStartBefore":"setEndBefore"](l),H(l)):t.warn("Marker element has been removed. Cannot restore selection.")}function x(e,f){return f.compareBoundaryPoints(e.START_TO_START,e)}function y(a,j){var k,l,m=s.DomRange.getRangeDocument(a),n=a.toString(),o=I(j);return a.collapsed?(l=v(a,!1),{document:m,markerId:l.id,collapsed:!0}):(l=v(a,!1),k=v(a,!0),{document:m,startMarkerId:k.id,endMarkerId:l.id,collapsed:!1,backward:o,toString:function(){return"original text: '"+n+"', new text: '"+a.toString()+"'"}})}function z(a,e){var k=a.document;"undefined"==typeof e&&(e=!0);var l=s.createRange(k);if(a.collapsed){var m=u(a.markerId,k);if(m){m.style.display="inline";var n=m.previousSibling;n&&3==n.nodeType?(H(m),l.collapseToPoint(n,n.length)):(l.collapseBefore(m),H(m))}else{t.warn("Marker element has been removed. Cannot restore selection.")}}else{w(k,l,a.startMarkerId,!0),w(k,l,a.endMarkerId,!1)}return e&&l.normalizeBoundaries(),l}function A(a,f){var g,m,n=[],o=I(f);a=a.slice(0),a.sort(x);for(var p=0,q=a.length;q>p;++p){n[p]=y(a[p],o)}for(p=q-1;p>=0;--p){g=a[p],m=s.DomRange.getRangeDocument(g),g.collapsed?g.collapseAfter(u(n[p].markerId,m)):(g.setEndBefore(u(n[p].endMarkerId,m)),g.setStartAfter(u(n[p].startMarkerId,m)))}return n}function B(a){if(!s.isSelectionValid(a)){return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null}var h=s.getSelection(a),i=h.getAllRanges(),j=1==i.length&&h.isBackward(),k=A(i,j);return j?h.setSingleRange(i[0],j):h.setRanges(i),{win:a,rangeInfos:k,restored:!1}}function C(e){for(var f=[],g=e.length,h=g-1;h>=0;h--){f[h]=z(e[h],!0)}return f}function D(a,h){if(!a.restored){var i=a.rangeInfos,j=s.getSelection(a.win),k=C(i),l=i.length;1==l&&h&&s.features.selectionHasExtend&&i[0].backward?(j.removeAllRanges(),j.addRange(k[0],!0)):j.setRanges(k),a.restored=!0}}function E(e,f){var g=u(f,e);g&&H(g)}function F(f){for(var g,h=f.rangeInfos,i=0,j=h.length;j>i;++i){g=h[i],g.collapsed?E(f.doc,g.markerId):(E(f.doc,g.startMarkerId),E(f.doc,g.endMarkerId))}}var G=s.dom,H=G.removeNode,I=s.Selection.isDirectionBackward,J="\ufeff";s.util.extend(s,{saveRange:y,restoreRange:z,saveRanges:A,restoreRanges:C,saveSelection:B,restoreSelection:D,removeMarkerElement:E,removeMarkers:F})}),b},this)}({},function(){return this}());
!function(j){function k(a,e){this.itemsArray=[],this.$element=j(a),this.$element.hide(),this.isSelect="SELECT"===a.tagName,this.multiple=this.isSelect&&a.hasAttribute("multiple"),this.objectItems=e&&e.itemValue,this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"",this.inputSize=Math.max(1,this.placeholderText.length),this.$container=j('<div class="bootstrap-tagsinput"></div>'),this.$input=j('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container),this.$element.after(this.$container);var f=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+f+" !important;",this.build(e)}function l(d,e){if("function"!=typeof d[e]){var f=d[e];d[e]=function(b){return b[f]}}}function m(d,e){if("function"!=typeof d[e]){var f=d[e];d[e]=function(){return f}}}function n(b){return b?r.text(b).html():""}function o(d){var e=0;if(document.selection){d.focus();var f=document.selection.createRange();f.moveStart("character",-d.value.length),e=f.text.length}else{(d.selectionStart||"0"==d.selectionStart)&&(e=d.selectionStart)}return e}function p(a,e){var f=!1;return j.each(e,function(b,d){if("number"==typeof d&&a.which===d){return f=!0,!1}if(a.which===d.which){var h=!d.hasOwnProperty("altKey")||a.altKey===d.altKey,i=!d.hasOwnProperty("shiftKey")||a.shiftKey===d.shiftKey,s=!d.hasOwnProperty("ctrlKey")||a.ctrlKey===d.ctrlKey;if(h&&i&&s){return f=!0,!1}}}),f}var q={tagClass:function(){return"label label-info"},itemValue:function(b){return b?b.toString():b},itemText:function(b){return this.itemValue(b)},freeInput:!0,addOnBlur:!0,maxTags:void 0,maxChars:void 0,confirmKeys:[13,44],onTagExists:function(c,d){d.hide().fadeIn()},trimValue:!1,allowDuplicates:!1};k.prototype={constructor:k,add:function(a,e){var s=this;if(!(s.options.maxTags&&s.itemsArray.length>=s.options.maxTags||a!==!1&&!a)){if("string"==typeof a&&s.options.trimValue&&(a=j.trim(a)),"object"==typeof a&&!s.objectItems){throw"Can't add objects when itemValue option is not set"}if(!a.toString().match(/^\s*$/)){if(s.isSelect&&!s.multiple&&s.itemsArray.length>0&&s.remove(s.itemsArray[0]),"string"==typeof a&&"INPUT"===this.$element[0].tagName){var t=a.split(",");if(t.length>1){for(var u=0;u<t.length;u++){this.add(t[u],!0)}return void (e||s.pushVal())}}var v=s.options.itemValue(a),w=s.options.itemText(a),x=s.options.tagClass(a),y=j.grep(s.itemsArray,function(b){return s.options.itemValue(b)===v})[0];if(!y||s.options.allowDuplicates){if(!(s.items().toString().length+a.length+1>s.options.maxInputLength)){var z=j.Event("beforeItemAdd",{item:a,cancel:!1});if(s.$element.trigger(z),!z.cancel){s.itemsArray.push(a);var A=j('<span class="tag '+n(x)+'">'+n(w)+'<span data-role="remove"></span></span>');if(A.data("item",a),s.findInputWrapper().before(A),A.after(" "),s.isSelect&&!j('option[value="'+encodeURIComponent(v)+'"]',s.$element)[0]){var B=j("<option selected>"+n(w)+"</option>");B.data("item",a),B.attr("value",v),s.$element.append(B)}e||s.pushVal(),(s.options.maxTags===s.itemsArray.length||s.items().toString().length===s.options.maxInputLength)&&s.$container.addClass("bootstrap-tagsinput-max"),s.$element.trigger(j.Event("itemAdded",{item:a}))}}}else{if(s.options.onTagExists){var C=j(".tag",s.$container).filter(function(){return j(this).data("item")===y});s.options.onTagExists(a,C)}}}}},remove:function(a,f){var g=this;if(g.objectItems&&(a="object"==typeof a?j.grep(g.itemsArray,function(b){return g.options.itemValue(b)==g.options.itemValue(a)}):j.grep(g.itemsArray,function(b){return g.options.itemValue(b)==a}),a=a[a.length-1]),a){var h=j.Event("beforeItemRemove",{item:a,cancel:!1});if(g.$element.trigger(h),h.cancel){return}j(".tag",g.$container).filter(function(){return j(this).data("item")===a}).remove(),j("option",g.$element).filter(function(){return j(this).data("item")===a}).remove(),-1!==j.inArray(a,g.itemsArray)&&g.itemsArray.splice(j.inArray(a,g.itemsArray),1)}f||g.pushVal(),g.options.maxTags>g.itemsArray.length&&g.$container.removeClass("bootstrap-tagsinput-max"),g.$element.trigger(j.Event("itemRemoved",{item:a}))},removeAll:function(){var a=this;for(j(".tag",a.$container).remove(),j("option",a.$element).remove();a.itemsArray.length>0;){a.itemsArray.pop()}a.pushVal()},refresh:function(){var a=this;j(".tag",a.$container).each(function(){var b=j(this),e=b.data("item"),s=a.options.itemValue(e),t=a.options.itemText(e),u=a.options.tagClass(e);if(b.attr("class",null),b.addClass("tag "+n(u)),b.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=n(t),a.isSelect){var v=j("option",a.$element).filter(function(){return j(this).data("item")===e});v.attr("value",s)}})},items:function(){return this.itemsArray},pushVal:function(){var a=this,d=j.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(d,!0).trigger("change")},build:function(a){var c=this;if(c.options=j.extend({},q,a),c.objectItems&&(c.options.freeInput=!1),l(c.options,"itemValue"),l(c.options,"itemText"),m(c.options,"tagClass"),c.options.typeahead){var d=c.options.typeahead||{};m(d,"source"),c.$input.typeahead(j.extend({},d,{source:function(e,h){function i(u){for(var v=[],w=0;w<u.length;w++){var x=c.options.itemText(u[w]);s[x]=u[w],v.push(x)}h(v)}this.map={};var s=this.map,t=d.source(e);j.isFunction(t.success)?t.success(i):j.isFunction(t.then)?t.then(i):j.when(t).then(i)},updater:function(b){c.add(this.map[b])},matcher:function(b){return -1!==b.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(b){return b.sort()},highlighter:function(e){var g=new RegExp("("+this.query+")","gi");return e.replace(g,"<strong>$1</strong>")}}))}if(c.options.typeaheadjs){var f=c.options.typeaheadjs||{};c.$input.typeahead(null,f).on("typeahead:selected",j.proxy(function(e,g){c.add(f.valueKey?g[f.valueKey]:g),c.$input.typeahead("val","")},c))}c.$container.on("click",j.proxy(function(){c.$element.attr("disabled")||c.$input.removeAttr("disabled"),c.$input.focus()},c)),c.options.addOnBlur&&c.options.freeInput&&c.$input.on("focusout",j.proxy(function(){0===j(".typeahead, .twitter-typeahead",c.$container).length&&(c.add(c.$input.val()),c.$input.val(""))},c)),c.$container.on("keydown","input",j.proxy(function(e){var s=j(e.target),t=c.findInputWrapper();if(c.$element.attr("disabled")){return void c.$input.attr("disabled","disabled")}switch(e.which){case 8:if(0===o(s[0])){var u=t.prev();u&&c.remove(u.data("item"))}break;case 46:if(0===o(s[0])){var v=t.next();v&&c.remove(v.data("item"))}break;case 37:var w=t.prev();0===s.val().length&&w[0]&&(w.before(t),s.focus());break;case 39:var x=t.next();0===s.val().length&&x[0]&&(x.after(t),s.focus())}var y=s.val().length;Math.ceil(y/5);s.attr("size",Math.max(this.inputSize,s.val().length))},c)),c.$container.on("keypress","input",j.proxy(function(e){var g=j(e.target);if(c.$element.attr("disabled")){return void c.$input.attr("disabled","disabled")}var i=g.val(),s=c.options.maxChars&&i.length>=c.options.maxChars;c.options.freeInput&&(p(e,c.options.confirmKeys)||s)&&(c.add(s?i.substr(0,c.options.maxChars):i),g.val(""),e.preventDefault());var t=g.val().length;Math.ceil(t/5);g.attr("size",Math.max(this.inputSize,g.val().length))},c)),c.$container.on("click","[data-role=remove]",j.proxy(function(e){c.$element.attr("disabled")||c.remove(j(e.target).closest(".tag").data("item"))},c)),c.options.itemValue===q.itemValue&&("INPUT"===c.$element[0].tagName?c.add(c.$element.val()):j("option",c.$element).each(function(){c.add(j(this).attr("value"),!0)}))},destroy:function(){var b=this;b.$container.off("keypress","input"),b.$container.off("click","[role=remove]"),b.$container.remove(),b.$element.removeData("tagsinput"),b.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],d=this.$container[0];a&&a.parentNode!==d;){a=a.parentNode}return j(a)}},j.fn.tagsinput=function(a,b){var f=[];return this.each(function(){var c=j(this).data("tagsinput");if(c){if(a||b){if(void 0!==c[a]){var d=c[a](b);void 0!==d&&f.push(d)}}else{f.push(c)}}else{c=new k(this,a),j(this).data("tagsinput",c),f.push(c),"SELECT"===this.tagName&&j("option",j(this)).attr("selected","selected"),j(this).val(j(this).val())}}),"string"==typeof a?f.length>1?f:f[0]:f},j.fn.tagsinput.Constructor=k;var r=j("<div />");j(function(){j("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})}(window.jQuery);
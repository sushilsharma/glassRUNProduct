(function(a){var b={tagClass:function(j){return"label label-info"},itemValue:function(j){return j?j.toString():j},itemText:function(j){return this.itemValue(j)},freeInput:true,addOnBlur:true,maxTags:undefined,maxChars:undefined,confirmKeys:[13,44],onTagExists:function(k,j){j.hide().fadeIn()},trimValue:false,allowDuplicates:false};function i(j,l){this.itemsArray=[];this.$element=a(j);this.$element.hide();this.isSelect=(j.tagName==="SELECT");this.multiple=(this.isSelect&&j.hasAttribute("multiple"));this.objectItems=l&&l.itemValue;this.placeholderText=j.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=a('<div class="bootstrap-tagsinput"></div>');this.$input=a('<input type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);this.$element.after(this.$container);var k=(this.inputSize<3?3:this.inputSize)+"em";this.$input.get(0).style.cssText="width: "+k+" !important;";this.build(l)}i.prototype={constructor:i,add:function(q,n){var u=this;if(u.options.maxTags&&u.itemsArray.length>=u.options.maxTags){return}if(q!==false&&!q){return}if(typeof q==="string"&&u.options.trimValue){q=a.trim(q)}if(typeof q==="object"&&!u.objectItems){throw ("Can't add objects when itemValue option is not set")}if(q.toString().match(/^\s*$/)){return}if(u.isSelect&&!u.multiple&&u.itemsArray.length>0){u.remove(u.itemsArray[0])}if(typeof q==="string"&&this.$element[0].tagName==="INPUT"){var r=q.split(",");if(r.length>1){for(var p=0;p<r.length;p++){this.add(r[p],true)}if(!n){u.pushVal()}return}}var t=u.options.itemValue(q),s=u.options.itemText(q),v=u.options.tagClass(q);var o=a.grep(u.itemsArray,function(w){return u.options.itemValue(w)===t})[0];if(o&&!u.options.allowDuplicates){if(u.options.onTagExists){var j=a(".tag",u.$container).filter(function(){return a(this).data("item")===o});u.options.onTagExists(q,j)}return}if(u.items().toString().length+q.length+1>u.options.maxInputLength){return}var m=a.Event("beforeItemAdd",{item:q,cancel:false});u.$element.trigger(m);if(m.cancel){return}u.itemsArray.push(q);var l=a('<span class="tag '+d(v)+'">'+d(s)+'<span data-role="remove"></span></span>');l.data("item",q);u.findInputWrapper().before(l);l.after(" ");if(u.isSelect&&!a('option[value="'+encodeURIComponent(t)+'"]',u.$element)[0]){var k=a("<option selected>"+d(s)+"</option>");k.data("item",q);k.attr("value",t);u.$element.append(k)}if(!n){u.pushVal()}if(u.options.maxTags===u.itemsArray.length||u.items().toString().length===u.options.maxInputLength){u.$container.addClass("bootstrap-tagsinput-max")}u.$element.trigger(a.Event("itemAdded",{item:q}))},remove:function(l,k){var m=this;if(m.objectItems){if(typeof l==="object"){l=a.grep(m.itemsArray,function(n){return m.options.itemValue(n)==m.options.itemValue(l)})}else{l=a.grep(m.itemsArray,function(n){return m.options.itemValue(n)==l})}l=l[l.length-1]}if(l){var j=a.Event("beforeItemRemove",{item:l,cancel:false});m.$element.trigger(j);if(j.cancel){return}a(".tag",m.$container).filter(function(){return a(this).data("item")===l}).remove();a("option",m.$element).filter(function(){return a(this).data("item")===l}).remove();if(a.inArray(l,m.itemsArray)!==-1){m.itemsArray.splice(a.inArray(l,m.itemsArray),1)}}if(!k){m.pushVal()}if(m.options.maxTags>m.itemsArray.length){m.$container.removeClass("bootstrap-tagsinput-max")}m.$element.trigger(a.Event("itemRemoved",{item:l}))},removeAll:function(){var j=this;a(".tag",j.$container).remove();a("option",j.$element).remove();while(j.itemsArray.length>0){j.itemsArray.pop()}j.pushVal()},refresh:function(){var j=this;a(".tag",j.$container).each(function(){var k=a(this),l=k.data("item"),n=j.options.itemValue(l),m=j.options.itemText(l),p=j.options.tagClass(l);k.attr("class",null);k.addClass("tag "+d(p));k.contents().filter(function(){return this.nodeType==3})[0].nodeValue=d(m);if(j.isSelect){var o=a("option",j.$element).filter(function(){return a(this).data("item")===l});o.attr("value",n)}})},items:function(){return this.itemsArray},pushVal:function(){var j=this,k=a.map(j.items(),function(l){return j.options.itemValue(l).toString()});j.$element.val(k,true).trigger("change")},build:function(j){var k=this;k.options=a.extend({},b,j);if(k.objectItems){k.options.freeInput=false}h(k.options,"itemValue");h(k.options,"itemText");g(k.options,"tagClass");if(k.options.typeahead){var l=k.options.typeahead||{};g(l,"source");k.$input.typeahead(a.extend({},l,{source:function(r,p){function q(t){var v=[];for(var s=0;s<t.length;s++){var u=k.options.itemText(t[s]);o[u]=t[s];v.push(u)}p(v)}this.map={};var o=this.map,n=l.source(r);if(a.isFunction(n.success)){n.success(q)}else{if(a.isFunction(n.then)){n.then(q)}else{a.when(n).then(q)}}},updater:function(n){k.add(this.map[n])},matcher:function(n){return(n.toLowerCase().indexOf(this.query.trim().toLowerCase())!==-1)},sorter:function(n){return n.sort()},highlighter:function(o){var n=new RegExp("("+this.query+")","gi");return o.replace(n,"<strong>$1</strong>")}}))}if(k.options.typeaheadjs){var m=k.options.typeaheadjs||{};k.$input.typeahead(null,m).on("typeahead:selected",a.proxy(function(o,n){if(m.valueKey){k.add(n[m.valueKey])}else{k.add(n)}k.$input.typeahead("val","")},k))}k.$container.on("click",a.proxy(function(n){if(!k.$element.attr("disabled")){k.$input.removeAttr("disabled")}k.$input.focus()},k));if(k.options.addOnBlur&&k.options.freeInput){k.$input.on("focusout",a.proxy(function(n){if(a(".typeahead, .twitter-typeahead",k.$container).length===0){k.add(k.$input.val());k.$input.val("")}},k))}k.$container.on("keydown","input",a.proxy(function(r){var n=a(r.target),o=k.findInputWrapper();if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}switch(r.which){case 8:if(c(n[0])===0){var t=o.prev();if(t){k.remove(t.data("item"))}}break;case 46:if(c(n[0])===0){var s=o.next();if(s){k.remove(s.data("item"))}}break;case 37:var q=o.prev();if(n.val().length===0&&q[0]){q.before(o);n.focus()}break;case 39:var p=o.next();if(n.val().length===0&&p[0]){p.after(o);n.focus()}break;default:}var v=n.val().length,w=Math.ceil(v/5),u=v+w+1;n.attr("size",Math.max(this.inputSize,n.val().length))},k));k.$container.on("keypress","input",a.proxy(function(o){var n=a(o.target);if(k.$element.attr("disabled")){k.$input.attr("disabled","disabled");return}var r=n.val(),p=k.options.maxChars&&r.length>=k.options.maxChars;if(k.options.freeInput&&(f(o,k.options.confirmKeys)||p)){k.add(p?r.substr(0,k.options.maxChars):r);n.val("");o.preventDefault()}var s=n.val().length,t=Math.ceil(s/5),q=s+t+1;n.attr("size",Math.max(this.inputSize,n.val().length))},k));k.$container.on("click","[data-role=remove]",a.proxy(function(n){if(k.$element.attr("disabled")){return}k.remove(a(n.target).closest(".tag").data("item"))},k));if(k.options.itemValue===b.itemValue){if(k.$element[0].tagName==="INPUT"){k.add(k.$element.val())}else{a("option",k.$element).each(function(){k.add(a(this).attr("value"),true)})}}},destroy:function(){var j=this;j.$container.off("keypress","input");j.$container.off("click","[role=remove]");j.$container.remove();j.$element.removeData("tagsinput");j.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){var k=this.$input[0],j=this.$container[0];while(k&&k.parentNode!==j){k=k.parentNode}return a(k)}};a.fn.tagsinput=function(j,k){var l=[];this.each(function(){var n=a(this).data("tagsinput");if(!n){n=new i(this,j);a(this).data("tagsinput",n);l.push(n);if(this.tagName==="SELECT"){a("option",a(this)).attr("selected","selected")}a(this).val(a(this).val())}else{if(!j&&!k){l.push(n)}else{if(n[j]!==undefined){var m=n[j](k);if(m!==undefined){l.push(m)}}}}});if(typeof j=="string"){return l.length>1?l:l[0]}else{return l}};a.fn.tagsinput.Constructor=i;function h(k,j){if(typeof k[j]!=="function"){var l=k[j];k[j]=function(m){return m[l]}}}function g(k,j){if(typeof k[j]!=="function"){var l=k[j];k[j]=function(){return l}}}var e=a("<div />");function d(j){if(j){return e.text(j).html()}else{return""}}function c(k){var j=0;if(document.selection){k.focus();var l=document.selection.createRange();l.moveStart("character",-k.value.length);j=l.text.length}else{if(k.selectionStart||k.selectionStart=="0"){j=k.selectionStart}}return(j)}function f(k,l){var j=false;a.each(l,function(o,p){if(typeof(p)==="number"&&k.which===p){j=true;return false}if(k.which===p.which){var m=!p.hasOwnProperty("altKey")||k.altKey===p.altKey,q=!p.hasOwnProperty("shiftKey")||k.shiftKey===p.shiftKey,n=!p.hasOwnProperty("ctrlKey")||k.ctrlKey===p.ctrlKey;if(m&&q&&n){j=true;return false}}});return j}a(function(){a("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);